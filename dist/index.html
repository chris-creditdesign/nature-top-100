<style scoped>
.status-message {
  border: 1px solid #c00;
  background: #fac7c7;
  padding: 10px;
}

.outer-wrapper {
  width: 100%;
  min-height: 900px;
  position: relative;
  border: 1px solid #c8c7cf;
}
.outer-wrapper h2, .outer-wrapper h3, .outer-wrapper p {
  padding: 10px 10px 0 10px;
  margin: 0;
}

</style>
<div class="outer-wrapper">
	<div class="chart"></div>
</div>
<!--[if gt IE 8]><!-->
<script type="text/javascript">
function buildGraphic (topData, margin, width, height, colour, duration) {

	var svg = d3.select(".outer-wrapper .chart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom);

	svg.append("rect")
		.attr("width", width)
		.attr("height", height)
		.attr("fill","none")
		.attr("stroke","skyblue")
		.attr("stroke-width", 0.25)
		.attr("x", margin.left)
		.attr("y", margin.top);

	var barsGroup = svg.append('g')
						.attr("transform","translate(" + margin.left + "," + margin.top + ")");
	
	/*	Define Y scale range to go from height to 0
		Do not define the domain yet */
	var xScale = d3.scale.linear()
		.range([0 , width])
		.domain([d3.min(topData, function(d) { return d.cites;}), d3.max(topData, function(d) { return d.cites;})]);

	var yScale = d3.scale.ordinal()
		.domain(d3.range(topData.length))
		.rangeBands([0, height], 0.2, 0);


	var bars = barsGroup.selectAll("rect")
		.data(topData, function(d, i) {
			return d.title;
		});

	/* Enterâ€¦ */
	bars.enter()
		.append("rect")
		.attr("x", function (d) {
			return (width/2) - (xScale(d.cites) / 2);
		})
		.attr("width", function(d) {
			return xScale(d.cites);
		})
		.attr("y", function(d, i){
			return yScale(i);
		})
		.attr("height", function () {
			return yScale.rangeBand();
		} )
		.attr("opacity",1)
		.attr("fill", function(d, i){

			my_colour = "#000";

			switch (d.discipline) {
				case "Statistics":
					my_colour = colour[0];
					break;
				case "Other":
					my_colour = colour[1];
					break;
				case "Math/Computer Science":
					my_colour = colour[2];
					break;
				case "Experimental, Social and Clinical Psychology":
					my_colour = colour[3];
					break;
				case "Discoveries":
					my_colour = colour[4];
					break;
				case "Crystallography":
					my_colour = colour[5];
					break;
				case "Condensed Matter Physics":
					my_colour = colour[6];
					break;
				case "Biomedical Research and Clinical Medicine":
					my_colour = colour[7];
					break;
				case "bioinformatics close to evolutionary biology":
					my_colour = colour[8];
					break;
				case "bioinformatics":
					my_colour = colour[9];
					break;
				case "biochem techniques":
					my_colour = colour[10];
					break;
				case "Atomic and Molecular Physics":
					my_colour = colour[11];
					break;
				default:
					my_colour = colour[0];
			}

			return my_colour;
		});


}
function buildSVG (margin, width, height) {

}
function buildDataSet (data) {
	var dataSet = [];

	var tableRows = jQuery(data).find("tbody tr");
	var headerRows = jQuery(data).find("thead tr").find('th');



	for (var i = 0; i < tableRows.length; i++) {
		var newObject = {};

		newObject.author = tableRows.eq(i).find("td").eq(0).text();
		newObject.title = tableRows.eq(i).find("td").eq(1).text();
		newObject.publication = tableRows.eq(i).find("td").eq(2).text();
		
		newObject.cites = parseInt(tableRows.eq(i).find("td").eq(3).text(), 10);

		newObject.year = parseInt(tableRows.eq(i).find("td").eq(4).text(), 10);
		
		newObject.doi = tableRows.eq(i).find("td").eq(5).text();
		newObject.discipline = tableRows.eq(i).find("td").eq(6).text();

		dataSet.push(newObject);
	}

	return dataSet;
}
(function() {
		var init = function($)
		{

		/*	==================================================================================== */
		/*	GLOBAL VARIABLES FOR D3 */

		/*  Colours for the bars */
		// var colour = ["#1abc9c","#27ae60","#3498db","#5959b7","#EB6B4B"];

		var colour =	["#ce071d",
						"#e95f0f",
						"#85b48b",
						"#302d2c",
						"#c2514e",
						"#e8af4a",
						"#dfc85c",
						"#a5b688",
						"#565279",
						"#8b0a1f",
						"#75c4c0",
						"#858986"];


		/*	Margin, Width and height */
		var margin = {top: 50, right: 20, bottom: 20, left: 20};
		var width = $('.section').width()  - margin.left - margin.right;
		var height = 600 - margin.top - margin.bottom;
		/*	Global variable to control the length of D3 transitons */
		var duration = 450;

		var topData;

		/*	==================================================================================== */
		/*	jQuery ready */

			/*	==================================================================================== */
			/*	Load D3 */
			/*	All of the D3/svg code is contained within the call back function */
			/*	Loading D3 into ie6-8 seems to cause a runtime error */
			$.getScript("http://www.nature.com/polopoly_static/js/d3.v3.min.js", function() {

				$.ajax({
					url: "data/top-100-edit-table.html",
					dataType: 'text',
					success: function (data) {
						topData = buildDataSet(data);
					}

				}).done(function () {
					

					var myGraphic = buildGraphic(topData, margin, width, height, colour, duration);

				}); /* End of ajax call */

			}); /* End of d3js getscript call

		/* End of active code */
		};


	setTimeout(function()
	{
	if (typeof jQuery !== 'undefined')
	{
		init(jQuery);
	} else
	{
		setTimeout(arguments.callee, 60);
	}
	}, 60);

})();
</script>
<!--<![endif]-->